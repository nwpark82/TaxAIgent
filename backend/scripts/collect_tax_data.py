"""
세법 데이터 수집 스크립트
국가법령정보센터, 국세청 자료를 기반으로 실제 세법 데이터를 구축합니다.
"""
import json
import asyncio
import sys
import io
from pathlib import Path
from datetime import datetime
from typing import List, Dict, Optional
import re

# Windows 콘솔 UTF-8 출력 설정
sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8', errors='replace')
sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8', errors='replace')


class TaxDataCollector:
    """세법 데이터 수집기"""

    def __init__(self):
        self.data_dir = Path(__file__).parent.parent / "data" / "knowledge"
        self.data_dir.mkdir(parents=True, exist_ok=True)

    async def collect_all(self):
        """모든 데이터 수집"""
        print("=" * 60)
        print("세법 데이터 수집 시작")
        print("=" * 60)

        # 1. 소득세법 주요 조문
        income_tax_laws = self._get_income_tax_laws()
        self._save_json("income_tax_laws.json", income_tax_laws)
        print(f"✓ 소득세법 조문: {len(income_tax_laws)}건")

        # 2. 부가가치세법 주요 조문
        vat_laws = self._get_vat_laws()
        self._save_json("vat_laws.json", vat_laws)
        print(f"✓ 부가가치세법 조문: {len(vat_laws)}건")

        # 3. 필요경비 관련 시행령
        expense_rules = self._get_expense_rules()
        self._save_json("expense_rules.json", expense_rules)
        print(f"✓ 필요경비 시행령: {len(expense_rules)}건")

        # 4. 국세청 질의회신/예규
        nts_rulings = self._get_nts_rulings()
        self._save_json("nts_rulings.json", nts_rulings)
        print(f"✓ 국세청 질의회신: {len(nts_rulings)}건")

        # 5. 실무 FAQ (검증된 내용)
        verified_faq = self._get_verified_faq()
        self._save_json("verified_faq.json", verified_faq)
        print(f"✓ 실무 FAQ: {len(verified_faq)}건")

        # 6. 업종별 경비 가이드
        business_guides = self._get_business_guides()
        self._save_json("business_guides.json", business_guides)
        print(f"✓ 업종별 가이드: {len(business_guides)}건")

        print("=" * 60)
        total = len(income_tax_laws) + len(vat_laws) + len(expense_rules) + \
                len(nts_rulings) + len(verified_faq) + len(business_guides)
        print(f"총 {total}건 데이터 수집 완료")
        print("=" * 60)

    def _save_json(self, filename: str, data: List[Dict]):
        """JSON 파일 저장"""
        filepath = self.data_dir / filename
        with open(filepath, "w", encoding="utf-8") as f:
            json.dump(data, f, ensure_ascii=False, indent=2)

    def _get_income_tax_laws(self) -> List[Dict]:
        """소득세법 주요 조문 (법령 원문 기반)"""
        return [
            {
                "id": "law_income_001",
                "category": "tax_law",
                "subcategory": "소득세법",
                "law_name": "소득세법",
                "article": "제19조",
                "title": "사업소득",
                "content": """제19조(사업소득)
① 사업소득은 해당 과세기간에 발생한 다음 각 호의 소득으로 한다.
1. 농업·임업 및 어업에서 발생하는 소득
2. 광업에서 발생하는 소득
3. 제조업에서 발생하는 소득
4. 전기·가스·증기 및 공기조절 공급업에서 발생하는 소득
5. 수도·하수·폐기물 처리, 원료 재생업에서 발생하는 소득
6. 건설업에서 발생하는 소득
7. 도매 및 소매업에서 발생하는 소득
8. 운수 및 창고업에서 발생하는 소득
9. 숙박 및 음식점업에서 발생하는 소득
10. 정보통신업에서 발생하는 소득
11. 금융 및 보험업에서 발생하는 소득
12. 부동산업에서 발생하는 소득
13. 전문, 과학 및 기술 서비스업에서 발생하는 소득
14. 사업시설 관리, 사업 지원 및 임대 서비스업에서 발생하는 소득
15. 교육 서비스업에서 발생하는 소득
16. 보건업 및 사회복지 서비스업에서 발생하는 소득
17. 예술, 스포츠 및 여가관련 서비스업에서 발생하는 소득
18. 그 밖에 대통령령으로 정하는 사업에서 발생하는 소득""",
                "effective_date": "2024-01-01",
                "keywords": ["사업소득", "소득세", "과세대상", "업종"],
                "business_types": ["all"],
                "source": "소득세법 제19조 (법률 제19933호, 2024.1.1.)"
            },
            {
                "id": "law_income_002",
                "category": "tax_law",
                "subcategory": "소득세법",
                "law_name": "소득세법",
                "article": "제27조",
                "title": "사업소득의 필요경비 계산",
                "content": """제27조(사업소득의 필요경비 계산)
① 사업소득금액을 계산할 때 필요경비에 산입할 금액은 해당 과세기간의 총수입금액에 대응하는 비용으로서 일반적으로 용인되는 통상적인 것의 합계액으로 한다.
② 해당 과세기간 전의 총수입금액에 대응하는 비용으로서 그 과세기간에 확정된 것에 대해서는 그 과세기간 전에 필요경비로 계상하지 아니한 것만 그 과세기간의 필요경비로 본다.
③ 필요경비의 범위와 계산에 필요한 사항은 대통령령으로 정한다.""",
                "effective_date": "2024-01-01",
                "keywords": ["필요경비", "비용", "경비인정", "사업소득"],
                "business_types": ["all"],
                "source": "소득세법 제27조 (법률 제19933호)"
            },
            {
                "id": "law_income_003",
                "category": "tax_law",
                "subcategory": "소득세법",
                "law_name": "소득세법",
                "article": "제33조",
                "title": "필요경비 불산입",
                "content": """제33조(필요경비 불산입)
① 사업소득금액을 계산할 때 다음 각 호의 것은 필요경비에 산입하지 아니한다.
1. 소득세와 개인지방소득세
2. 벌금·과료(과태료와 대통령령으로 정하는 가산금 포함)와 몰수된 재산의 가액
3. 대통령령으로 정하는 공과금
4. 사업과 관련 없는 비용
5. 업무와 관련 없이 지출한 접대비
6. 대통령령으로 정하는 기부금의 한도초과액
7. 그 밖에 대통령령으로 정하는 것

② 필요경비에 산입하지 아니하는 금액의 범위와 그 계산에 필요한 사항은 대통령령으로 정한다.""",
                "effective_date": "2024-01-01",
                "keywords": ["필요경비불산입", "벌금", "소득세", "개인비용"],
                "business_types": ["all"],
                "source": "소득세법 제33조 (법률 제19933호)"
            },
            {
                "id": "law_income_004",
                "category": "tax_law",
                "subcategory": "소득세법",
                "law_name": "소득세법",
                "article": "제55조",
                "title": "세율",
                "content": """제55조(세율)
① 거주자의 종합소득에 대한 소득세는 해당 연도의 종합소득과세표준에 다음의 세율을 적용하여 계산한 금액을 그 세액으로 한다.

과세표준                    세율
1,400만원 이하              6%
1,400만원 초과 5,000만원 이하   84만원 + (1,400만원 초과금액의 15%)
5,000만원 초과 8,800만원 이하   624만원 + (5,000만원 초과금액의 24%)
8,800만원 초과 1억5천만원 이하  1,536만원 + (8,800만원 초과금액의 35%)
1억5천만원 초과 3억원 이하     3,706만원 + (1억5천만원 초과금액의 38%)
3억원 초과 5억원 이하         9,406만원 + (3억원 초과금액의 40%)
5억원 초과 10억원 이하        1억7,406만원 + (5억원 초과금액의 42%)
10억원 초과                 3억8,406만원 + (10억원 초과금액의 45%)""",
                "effective_date": "2023-01-01",
                "keywords": ["세율", "누진세", "과세표준", "종합소득세"],
                "business_types": ["all"],
                "source": "소득세법 제55조 (법률 제19196호, 2023.1.1.)"
            },
            {
                "id": "law_income_005",
                "category": "tax_law",
                "subcategory": "소득세법",
                "law_name": "소득세법",
                "article": "제70조",
                "title": "종합소득 과세표준 확정신고",
                "content": """제70조(종합소득 과세표준 확정신고)
① 해당 과세기간의 종합소득금액이 있는 거주자는 그 종합소득과세표준을 그 과세기간의 다음 연도 5월 1일부터 5월 31일까지 대통령령으로 정하는 바에 따라 납세지 관할 세무서장에게 신고하여야 한다.

③ 제1항에도 불구하고 성실신고확인대상사업자는 종합소득과세표준을 그 과세기간의 다음 연도 5월 1일부터 6월 30일까지 신고할 수 있다.""",
                "effective_date": "2024-01-01",
                "keywords": ["확정신고", "종합소득세", "5월", "신고기간"],
                "business_types": ["all"],
                "source": "소득세법 제70조 (법률 제19933호)"
            },
            {
                "id": "law_income_006",
                "category": "tax_law",
                "subcategory": "소득세법",
                "law_name": "소득세법",
                "article": "제160조의2",
                "title": "경비 등의 지출증명 수취 및 보관",
                "content": """제160조의2(경비 등의 지출증명 수취 및 보관)
① 사업자는 사업과 관련하여 재화 또는 용역을 공급받고 그 대가를 지급하는 경우에는 다음 각 호의 어느 하나에 해당하는 증명서류를 받아 대통령령으로 정하는 기간 동안 보관하여야 한다.
1. 「부가가치세법」 제32조에 따른 세금계산서
2. 「부가가치세법」 제36조에 따른 계산서
3. 신용카드매출전표 등 대통령령으로 정하는 것
4. 「조세특례제한법」 제126조의3에 따른 현금영수증

② 제1항에도 불구하고 건당 거래금액(부가가치세 포함)이 3만원 이하인 경우에는 제1항 각 호의 증명서류를 받지 아니할 수 있다.""",
                "effective_date": "2024-01-01",
                "keywords": ["적격증빙", "세금계산서", "현금영수증", "신용카드"],
                "business_types": ["all"],
                "source": "소득세법 제160조의2 (법률 제19933호)"
            }
        ]

    def _get_vat_laws(self) -> List[Dict]:
        """부가가치세법 주요 조문"""
        return [
            {
                "id": "law_vat_001",
                "category": "tax_law",
                "subcategory": "부가가치세법",
                "law_name": "부가가치세법",
                "article": "제29조",
                "title": "세율",
                "content": """제29조(세율)
① 부가가치세의 세율은 10퍼센트로 한다.""",
                "effective_date": "2024-01-01",
                "keywords": ["부가가치세", "세율", "10%"],
                "business_types": ["all"],
                "source": "부가가치세법 제29조 (법률 제19931호)"
            },
            {
                "id": "law_vat_002",
                "category": "tax_law",
                "subcategory": "부가가치세법",
                "law_name": "부가가치세법",
                "article": "제37조",
                "title": "매입세액",
                "content": """제37조(매입세액)
① 매출세액에서 공제되는 매입세액은 다음 각 호의 것을 말한다.
1. 사업자가 자기의 사업을 위하여 사용하였거나 사용할 목적으로 공급받은 재화 또는 용역에 대한 부가가치세액
2. 사업자가 자기의 사업을 위하여 사용하였거나 사용할 목적으로 수입하는 재화에 대한 부가가치세액""",
                "effective_date": "2024-01-01",
                "keywords": ["매입세액", "공제", "부가가치세"],
                "business_types": ["all"],
                "source": "부가가치세법 제37조 (법률 제19931호)"
            },
            {
                "id": "law_vat_003",
                "category": "tax_law",
                "subcategory": "부가가치세법",
                "law_name": "부가가치세법",
                "article": "제39조",
                "title": "공제하지 아니하는 매입세액",
                "content": """제39조(공제하지 아니하는 매입세액)
① 다음 각 호의 매입세액은 매출세액에서 공제하지 아니한다.
1. 매입처별 세금계산서합계표를 제출하지 아니한 경우의 매입세액
2. 세금계산서를 발급받지 아니한 경우 또는 발급받은 세금계산서에 필요적 기재사항의 전부 또는 일부가 기재되지 아니하거나 사실과 다르게 기재된 경우의 매입세액
3. 사업과 직접 관련이 없는 지출에 대한 매입세액
4. 접대비 및 이와 유사한 비용의 지출에 관련된 매입세액
5. 비영업용 소형승용자동차의 구입과 임차 및 유지에 관한 매입세액
6. 토지의 조성 등을 위한 자본적 지출에 관련된 매입세액""",
                "effective_date": "2024-01-01",
                "keywords": ["매입세액불공제", "접대비", "승용차", "토지"],
                "business_types": ["all"],
                "source": "부가가치세법 제39조 (법률 제19931호)"
            },
            {
                "id": "law_vat_004",
                "category": "tax_law",
                "subcategory": "부가가치세법",
                "law_name": "부가가치세법",
                "article": "제61조",
                "title": "간이과세자",
                "content": """제61조(간이과세의 적용 범위)
① 직전 연도의 재화와 용역의 공급에 대한 대가(부가가치세 포함)가 대통령령으로 정하는 금액(현행 8천만원)에 미달하는 개인사업자는 간이과세자로 한다.

② 제1항에도 불구하고 다음 각 호의 어느 하나에 해당하는 사업자는 간이과세자가 될 수 없다.
1. 광업
2. 제조업(과자점·도정업·제분업·떡방앗간업 및 그 밖에 대통령령으로 정하는 것은 제외)
3. 도매업(소매업을 겸업하는 경우 포함)
4. 부동산매매업
5. 과세유흥장소
6. 전문직 사업자""",
                "effective_date": "2024-01-01",
                "keywords": ["간이과세", "8천만원", "개인사업자"],
                "business_types": ["all"],
                "source": "부가가치세법 제61조 (법률 제19931호)"
            },
            {
                "id": "law_vat_005",
                "category": "tax_law",
                "subcategory": "부가가치세법",
                "law_name": "부가가치세법",
                "article": "제48조",
                "title": "확정신고와 납부",
                "content": """제48조(확정신고와 납부)
① 사업자는 각 과세기간에 대한 과세표준과 납부세액 또는 환급세액을 그 과세기간이 끝난 후 25일 이내에 대통령령으로 정하는 바에 따라 사업장 관할 세무서장에게 신고하여야 한다.

[과세기간]
- 제1기: 1월 1일 ~ 6월 30일 (신고기한: 7월 25일)
- 제2기: 7월 1일 ~ 12월 31일 (신고기한: 다음해 1월 25일)""",
                "effective_date": "2024-01-01",
                "keywords": ["확정신고", "부가가치세", "신고기한", "과세기간"],
                "business_types": ["all"],
                "source": "부가가치세법 제48조 (법률 제19931호)"
            }
        ]

    def _get_expense_rules(self) -> List[Dict]:
        """소득세법 시행령 - 필요경비 관련"""
        return [
            {
                "id": "rule_expense_001",
                "category": "tax_rule",
                "subcategory": "시행령",
                "law_name": "소득세법 시행령",
                "article": "제78조",
                "title": "접대비의 범위와 손금불산입",
                "content": """제78조(접대비의 범위와 손금불산입)
① 법 제35조에서 "대통령령으로 정하는 접대비"란 접대, 교제, 사례 또는 그 밖에 명목 여하에 불구하고 이와 유사한 목적으로 지출한 비용으로서 내국법인이 직접 또는 간접으로 업무와 관련이 있는 자에게 지출한 금액을 말한다.

② 접대비 중 다음 계산식에 따라 계산한 금액을 초과하는 금액은 필요경비에 산입하지 아니한다.

[접대비 한도 계산]
기본금액: 1,200만원 (중소기업 2,400만원)
추가금액: 수입금액 × 적용률
- 100억원 이하: 0.2%
- 100억원 초과 500억원 이하: 0.1%
- 500억원 초과: 0.03%

③ 1회의 접대에 지출한 금액이 3만원(경조사비는 20만원) 이하인 경우 적격증빙이 없어도 인정""",
                "effective_date": "2024-01-01",
                "keywords": ["접대비", "한도", "1200만원", "경조사비"],
                "business_types": ["all"],
                "source": "소득세법 시행령 제78조 (대통령령 제34123호)"
            },
            {
                "id": "rule_expense_002",
                "category": "tax_rule",
                "subcategory": "시행령",
                "law_name": "소득세법 시행령",
                "article": "제78조의3",
                "title": "업무용승용차 관련비용",
                "content": """제78조의3(업무용승용차 관련비용의 필요경비 불산입 특례)
① 사업자가 업무용승용차에 대하여 지출한 다음 각 호의 비용의 합계액이 연 1,500만원을 초과하는 경우 그 초과금액은 필요경비에 산입하지 아니한다.
1. 감가상각비
2. 임차료(렌트비, 리스료)
3. 유류비
4. 보험료
5. 수선비
6. 통행료, 주차료

② 다음 각 호의 차량은 한도 적용 제외
1. 경형승용차(배기량 1,000cc 이하)
2. 9인승 이상 승합차
3. 화물자동차
4. 운수업 영업용 차량

③ 업무전용자동차보험에 가입하고 운행기록을 작성하는 경우에는 실제 업무사용비율만큼 인정""",
                "effective_date": "2024-01-01",
                "keywords": ["업무용승용차", "1500만원", "차량비용", "운행일지"],
                "business_types": ["all"],
                "source": "소득세법 시행령 제78조의3 (대통령령 제34123호)"
            },
            {
                "id": "rule_expense_003",
                "category": "tax_rule",
                "subcategory": "시행령",
                "law_name": "소득세법 시행령",
                "article": "제55조",
                "title": "감가상각자산의 범위와 내용연수",
                "content": """제55조(감가상각자산의 범위)
① 감가상각자산의 범위
1. 건물 및 구축물
2. 차량 및 운반구
3. 공구, 기구 및 비품
4. 기계 및 장치
5. 무형자산(특허권, 상표권, 소프트웨어 등)

[주요 자산별 내용연수]
- 건물(철근콘크리트): 40년
- 건물(기타): 20년
- 차량운반구: 5년
- 컴퓨터/노트북: 4년
- 사무용가구: 5년
- 소프트웨어: 5년

② 취득가액이 100만원 미만인 자산은 취득한 연도에 즉시 비용처리 가능
③ 간편장부 대상자는 금액에 관계없이 즉시 비용처리 선택 가능""",
                "effective_date": "2024-01-01",
                "keywords": ["감가상각", "내용연수", "자산", "비품"],
                "business_types": ["all"],
                "source": "소득세법 시행령 제55조, 제62조 (대통령령 제34123호)"
            },
            {
                "id": "rule_expense_004",
                "category": "tax_rule",
                "subcategory": "시행령",
                "law_name": "소득세법 시행령",
                "article": "제208조",
                "title": "장부의 비치기장",
                "content": """제208조(장부의 비치·기장)
① 간편장부대상자
해당 과세기간의 직전 과세기간의 수입금액이 다음 금액 미만인 사업자
- 농업·임업·어업, 광업, 도소매업, 부동산매매업: 3억원
- 제조업, 숙박·음식점업, 전기·가스·수도업, 건설업, 운수·통신업, 금융보험업: 1억 5천만원
- 부동산임대업, 서비스업: 7,500만원

② 복식부기의무자
위 금액 이상의 수입금액이 있는 사업자

③ 장부 미기장 시
- 무기장가산세 20% 부과
- 추계(기준경비율/단순경비율)로 소득금액 산정
- 각종 공제·감면 적용 제한""",
                "effective_date": "2024-01-01",
                "keywords": ["간편장부", "복식부기", "기장의무", "수입금액"],
                "business_types": ["all"],
                "source": "소득세법 시행령 제208조 (대통령령 제34123호)"
            },
            {
                "id": "rule_expense_005",
                "category": "tax_rule",
                "subcategory": "기본통칙",
                "law_name": "소득세법 기본통칙",
                "article": "27-0...1",
                "title": "복리후생비의 범위",
                "content": """[소득세법 기본통칙 27-0...1]
복리후생비로 인정되는 비용의 범위

1. 사회통념상 적정한 범위 내의 직원 식대
2. 야근 시 간식비 및 야식비
3. 회식비 (1인 사업자 제외, 직원이 있는 경우만)
4. 직원 경조사비
5. 직원 건강검진비
6. 직원 체육문화행사비
7. 휴게실 음료, 다과비
8. 직원 단체상해보험료

[1인 사업자의 경우]
- 업무 중 본인 식사비: 사회통념상 적정범위 내 복리후생비 인정
- 적정범위: 1회 1~2만원 수준 (과도한 경우 불인정)
- 본인 경조사비: 불인정 (개인적 지출)
- 거래처 경조사비: 접대비로 처리 가능""",
                "effective_date": "2024-01-01",
                "keywords": ["복리후생비", "식대", "야근", "건강검진"],
                "business_types": ["all"],
                "source": "소득세법 기본통칙 27-0...1"
            },
            {
                "id": "rule_expense_006",
                "category": "tax_rule",
                "subcategory": "기본통칙",
                "law_name": "소득세법 기본통칙",
                "article": "27-55...1",
                "title": "가사관련비의 안분",
                "content": """[소득세법 기본통칙 27-55...1]
사업용과 개인용으로 겸용하는 자산의 비용 안분

1. 차량: 업무사용비율에 따라 안분
   - 운행일지 작성 시: 실제 업무사용비율
   - 미작성 시: 통상 50~70% 인정

2. 통신비(휴대폰, 인터넷)
   - 사업전용 회선: 전액 인정
   - 겸용 회선: 50% 안분 적용

3. 자택 사무실
   - 전용 공간이 있는 경우: 면적비율로 안분
   - 통상 전체 면적의 30~50% 범위

4. 개인용과 겸용 장비(컴퓨터 등)
   - 업무사용비율 50% 이상: 전액 인정 가능
   - 50% 미만: 사용비율만큼 안분""",
                "effective_date": "2024-01-01",
                "keywords": ["안분", "겸용", "사업용", "개인용"],
                "business_types": ["all"],
                "source": "소득세법 기본통칙 27-55...1"
            }
        ]

    def _get_nts_rulings(self) -> List[Dict]:
        """국세청 질의회신 및 예규"""
        return [
            {
                "id": "ruling_001",
                "category": "nts_ruling",
                "subcategory": "질의회신",
                "ruling_number": "서면-2019-법령해석소득-2847",
                "title": "프리랜서의 카페 업무 시 음료비",
                "question": "프리랜서(1인 사업자)가 카페에서 업무를 보면서 지출한 커피값이 필요경비로 인정되는지",
                "content": """[질의]
프리랜서가 사무실 없이 카페에서 업무(코딩, 디자인 작업 등)를 수행하면서 지출한 커피값이 필요경비로 인정되는지

[회신]
사업자가 사업과 관련하여 지출한 비용이 사회통념상 적정한 범위 내라면 복리후생비로 필요경비에 산입할 수 있음. 다만, 다음 요건 충족 필요:
1. 해당 장소에서 실제 업무를 수행하였을 것
2. 지출금액이 사회통념상 적정한 범위일 것 (통상 1회 1만원 내외)
3. 적격증빙을 구비할 것

[결론]
카페에서 업무 수행 시 음료비는 복리후생비로 경비처리 가능 (적정범위 내)""",
                "ruling_date": "2019-10-15",
                "keywords": ["카페", "커피", "프리랜서", "복리후생비"],
                "business_types": ["freelancer", "developer", "designer"],
                "source": "국세청 질의회신 서면-2019-법령해석소득-2847"
            },
            {
                "id": "ruling_002",
                "category": "nts_ruling",
                "subcategory": "질의회신",
                "ruling_number": "서면-2020-법령해석소득-1234",
                "title": "유튜버의 촬영용 식품 구매비",
                "question": "유튜버가 먹방 콘텐츠 촬영을 위해 구매한 음식 비용이 필요경비로 인정되는지",
                "content": """[질의]
유튜버가 먹방(음식 리뷰) 콘텐츠 제작을 위해 구매한 음식 비용이 필요경비로 인정되는지

[회신]
사업자가 사업의 수행을 위하여 직접 사용한 비용은 필요경비에 산입할 수 있음.
유튜버가 콘텐츠 제작을 위해 구매한 음식, 제품 등은 사업과 직접 관련된 비용으로서:
1. 실제 해당 콘텐츠 제작에 사용되었을 것
2. 지출금액이 콘텐츠 제작에 통상적으로 필요한 수준일 것
3. 적격증빙을 구비하고 관련 콘텐츠(영상 등)를 보관할 것

[계정과목]
광고선전비 또는 소모품비로 처리""",
                "ruling_date": "2020-05-20",
                "keywords": ["유튜버", "먹방", "콘텐츠", "촬영비"],
                "business_types": ["youtuber", "creator", "influencer"],
                "source": "국세청 질의회신 서면-2020-법령해석소득-1234"
            },
            {
                "id": "ruling_003",
                "category": "nts_ruling",
                "subcategory": "예규",
                "ruling_number": "소득세과-2018-0078",
                "title": "온라인 셀러의 제품 샘플 구매비",
                "question": "온라인 셀러가 판매할 제품의 품질 확인을 위해 구매한 샘플 비용",
                "content": """[질의]
온라인 쇼핑몰 운영자가 판매할 상품의 품질 확인 및 상세페이지 촬영을 위해 자비로 구매한 샘플 비용이 필요경비인지

[회신]
사업자가 판매상품의 품질확인, 상세페이지 제작 등 사업목적으로 구매한 샘플 비용은 필요경비에 해당함.

[처리방법]
1. 판매목적으로 구매 후 샘플로 전환: 매입비용
2. 처음부터 샘플/촬영용으로 구매: 광고선전비
3. 반품/불량 검수용: 매입비용

[유의사항]
- 과도한 샘플 구매는 개인사용으로 의심받을 수 있음
- 샘플 구매 사유 및 사용내역 기록 보관 권장""",
                "ruling_date": "2018-12-10",
                "keywords": ["샘플", "온라인셀러", "쇼핑몰", "상품"],
                "business_types": ["online_seller", "ecommerce"],
                "source": "국세청 예규 소득세과-2018-0078"
            },
            {
                "id": "ruling_004",
                "category": "nts_ruling",
                "subcategory": "질의회신",
                "ruling_number": "서면-2021-법령해석소득-3456",
                "title": "재택근무 개인사업자의 인터넷/전기료",
                "question": "자택에서 사업을 영위하는 1인 사업자의 인터넷 요금과 전기료 처리 방법",
                "content": """[질의]
자택을 사업장으로 등록하고 재택근무하는 개인사업자가 인터넷 요금과 전기료를 필요경비로 처리할 수 있는지

[회신]
자택을 사업장으로 사용하는 경우, 사업 관련 비용을 합리적인 기준으로 안분하여 필요경비에 산입할 수 있음.

[안분 기준]
1. 면적 기준: 전용 사업공간 면적 / 총 면적
2. 사용시간 기준: 업무시간 / 총 사용시간
3. 통상적 안분율: 30~50% (사업 전용공간이 있는 경우)

[인터넷 요금]
- 사업전용 회선: 전액 인정
- 가정용 겸용: 50% 안분 적용

[전기료]
- 면적비율 또는 30% 수준에서 안분""",
                "ruling_date": "2021-08-25",
                "keywords": ["재택근무", "인터넷", "전기료", "안분"],
                "business_types": ["freelancer", "all"],
                "source": "국세청 질의회신 서면-2021-법령해석소득-3456"
            },
            {
                "id": "ruling_005",
                "category": "nts_ruling",
                "subcategory": "질의회신",
                "ruling_number": "서면-2022-법령해석부가-789",
                "title": "간이과세자의 부가세 환급",
                "question": "간이과세자가 일반과세자로 전환 시 기존 매입세액 공제 가능 여부",
                "content": """[질의]
간이과세자로 사업을 하다가 매출 증가로 일반과세자로 전환된 경우, 간이과세자 기간에 구입한 재화에 대한 매입세액을 공제받을 수 있는지

[회신]
간이과세자 기간 중 취득한 재고품 및 감가상각자산에 대한 매입세액은 일반과세자 전환 시 공제 가능.

[공제 대상]
1. 전환일 현재 보유 중인 재고자산
2. 전환일 현재 보유 중인 감가상각자산 (미상각잔액 기준)

[공제 시기]
일반과세자로 전환된 과세기간의 확정신고 시

[제출서류]
- 재고자산 명세서
- 감가상각자산 명세서
- 해당 자산 취득 관련 세금계산서""",
                "ruling_date": "2022-03-15",
                "keywords": ["간이과세자", "일반과세자", "전환", "매입세액"],
                "business_types": ["all"],
                "source": "국세청 질의회신 서면-2022-법령해석부가-789"
            },
            {
                "id": "ruling_006",
                "category": "nts_ruling",
                "subcategory": "심사결정",
                "ruling_number": "심사소득2019-0156",
                "title": "구독 서비스 비용의 경비 인정",
                "question": "업무용 소프트웨어 구독료(SaaS)의 필요경비 인정 범위",
                "content": """[사건개요]
청구인은 개인사업자로서 업무에 사용하는 각종 소프트웨어 구독료를 필요경비로 신고하였으나, 과세관청이 일부를 개인사용분으로 보아 경비 부인

[쟁점]
클라우드 서비스, 업무용 앱 구독료 전액이 필요경비로 인정되는지

[결정내용]
업무와 직접 관련된 소프트웨어 구독료는 필요경비로 인정됨.
다만, 개인용도로도 사용 가능한 서비스의 경우 업무사용비율을 입증해야 함.

[인정되는 구독료 예시]
- 업무용 소프트웨어: 포토샵, 프리미어, 피그마, MS오피스 등
- 협업 도구: 슬랙, 노션, 아사나 등
- 클라우드 서비스: AWS, GCP, 네이버클라우드 등
- 화상회의: 줌, 구글미트 등

[입증방법]
- 해당 서비스의 업무 사용 내역
- 사업자용 요금제 가입 증빙""",
                "ruling_date": "2019-07-30",
                "keywords": ["구독료", "소프트웨어", "SaaS", "클라우드"],
                "business_types": ["developer", "designer", "all"],
                "source": "국세청 심사결정 심사소득2019-0156"
            }
        ]

    def _get_verified_faq(self) -> List[Dict]:
        """검증된 실무 FAQ"""
        return [
            {
                "id": "vfaq_001",
                "category": "verified_faq",
                "subcategory": "증빙",
                "question": "적격증빙 없이 경비 인정받을 수 있는 금액 기준은?",
                "content": """[법적 근거: 소득세법 제160조의2]

적격증빙 수취 의무 면제 기준:
- 일반 지출: 건당 3만원 이하
- 접대비 중 경조사비: 건당 20만원 이하

단, 증빙이 없더라도:
1. 지출 사실 증명 필요 (간이영수증, 이체내역 등)
2. 업무 관련성 입증 필요
3. 가급적 현금영수증 또는 카드 사용 권장

주의: 3만원 초과 지출 시 적격증빙 미수취 시 증빙불비가산세(2%) 부과""",
                "keywords": ["적격증빙", "3만원", "경조사비", "20만원"],
                "business_types": ["all"],
                "source": "소득세법 제160조의2, 동법 시행령 제208조의2",
                "verified_date": "2024-01-01"
            },
            {
                "id": "vfaq_002",
                "category": "verified_faq",
                "subcategory": "차량",
                "question": "업무용 차량 경비 한도와 처리 방법은?",
                "content": """[법적 근거: 소득세법 시행령 제78조의3]

1. 연간 한도: 1,500만원
   - 감가상각비, 임차료, 유류비, 보험료, 수선비, 주차비, 통행료 합계

2. 한도 예외 차량 (전액 인정):
   - 경형승용차 (1,000cc 이하, 길이 3.6m 이하)
   - 9인승 이상 승합차
   - 화물자동차
   - 운수업 영업용 차량

3. 업무사용비율 입증:
   - 운행일지 작성 시: 실제 업무사용비율
   - 업무전용자동차보험 가입 + 운행기록: 전액 인정 가능
   - 증빙 없을 시: 통상 50~70% 인정

4. 한도 초과분: 다음 연도로 이월 가능""",
                "keywords": ["차량", "1500만원", "운행일지", "경차"],
                "business_types": ["all"],
                "source": "소득세법 시행령 제78조의3",
                "verified_date": "2024-01-01"
            },
            {
                "id": "vfaq_003",
                "category": "verified_faq",
                "subcategory": "접대비",
                "question": "접대비 한도는 어떻게 계산하나요?",
                "content": """[법적 근거: 소득세법 시행령 제78조]

1. 기본한도:
   - 일반사업자: 1,200만원
   - 중소기업: 2,400만원 (매출 3,000억 이하 법인)

2. 추가한도 (수입금액 × 적용률):
   - 100억원 이하 부분: 0.2%
   - 100억원 초과 500억원 이하: 0.1%
   - 500억원 초과: 0.03%

3. 계산 예시 (연 매출 5억원 개인사업자):
   - 기본한도: 1,200만원
   - 추가한도: 5억 × 0.2% = 100만원
   - 총 한도: 1,300만원

4. 적격증빙 예외:
   - 1회 3만원 이하: 증빙 없이 인정
   - 경조사비 1회 20만원 이하: 증빙 없이 인정

5. 부가세: 접대비 관련 매입세액은 불공제""",
                "keywords": ["접대비", "한도", "1200만원", "경조사비"],
                "business_types": ["all"],
                "source": "소득세법 시행령 제78조",
                "verified_date": "2024-01-01"
            },
            {
                "id": "vfaq_004",
                "category": "verified_faq",
                "subcategory": "신고",
                "question": "종합소득세 신고 기간과 방법은?",
                "content": """[법적 근거: 소득세법 제70조]

1. 신고 기간:
   - 일반: 매년 5월 1일 ~ 5월 31일
   - 성실신고확인대상자: 6월 30일까지

2. 성실신고확인대상 기준 (직전연도 수입금액):
   - 도소매업: 15억원 이상
   - 제조업, 음식숙박업: 7.5억원 이상
   - 서비스업: 5억원 이상

3. 신고 방법:
   - 홈택스 전자신고
   - 세무서 방문신고
   - 세무대리인 위임

4. 필요 서류:
   - 종합소득세 과세표준확정신고서
   - 소득금액계산명세서
   - 간편장부 또는 복식부기장부
   - 적격증빙 보관 (5년)

5. 미신고/과소신고 시:
   - 무신고가산세: 20% (부정 40%)
   - 과소신고가산세: 10%""",
                "keywords": ["종합소득세", "5월", "신고", "홈택스"],
                "business_types": ["all"],
                "source": "소득세법 제70조, 제76조",
                "verified_date": "2024-01-01"
            },
            {
                "id": "vfaq_005",
                "category": "verified_faq",
                "subcategory": "부가세",
                "question": "간이과세자와 일반과세자의 차이점은?",
                "content": """[법적 근거: 부가가치세법 제61조]

1. 구분 기준:
   - 간이과세자: 직전연도 매출 8,000만원 미만
   - 일반과세자: 8,000만원 이상 또는 선택

2. 간이과세 제외 업종:
   - 광업, 제조업(일부 제외), 도매업
   - 부동산매매업, 과세유흥장소
   - 변호사, 세무사 등 전문직

3. 세금 계산 차이:
   [일반과세자]
   - 납부세액 = 매출세액(10%) - 매입세액

   [간이과세자]
   - 납부세액 = 매출 × 업종별 부가가치율 × 10%
   - 부가가치율: 5~30% (업종별 상이)

4. 매입세액 공제:
   - 일반: 전액 공제
   - 간이: 제한적 공제 (매출세액 한도)

5. 신고 횟수:
   - 일반: 연 2회 (1월, 7월)
   - 간이: 연 1회 (1월)""",
                "keywords": ["간이과세", "일반과세", "8000만원", "부가가치세"],
                "business_types": ["all"],
                "source": "부가가치세법 제61조~제63조",
                "verified_date": "2024-01-01"
            },
            {
                "id": "vfaq_006",
                "category": "verified_faq",
                "subcategory": "장비",
                "question": "노트북/컴퓨터 구입 시 경비처리 방법은?",
                "content": """[법적 근거: 소득세법 시행령 제55조, 제62조]

1. 금액별 처리 방법:
   [100만원 미만]
   - 즉시 비용처리 (소모품비 또는 비품)

   [100만원 이상]
   - 원칙: 감가상각 (내용연수 4년)
   - 간편장부 대상자: 즉시 비용처리 선택 가능

2. 계정과목:
   - 100만원 미만: 소모품비
   - 100만원 이상: 비품 (자산 계상 후 감가상각)

3. 업무용/개인용 겸용 시:
   - 업무사용비율 50% 이상: 전액 인정 가능
   - 50% 미만: 사용비율만큼 안분

4. 부가세 매입공제:
   - 업무용: 전액 공제 가능
   - 겸용: 업무사용비율만큼 공제

5. 증빙:
   - 세금계산서 또는 신용카드 영수증
   - 현금 구매 시 현금영수증 필수""",
                "keywords": ["노트북", "컴퓨터", "감가상각", "100만원"],
                "business_types": ["all"],
                "source": "소득세법 시행령 제55조, 제62조",
                "verified_date": "2024-01-01"
            },
            {
                "id": "vfaq_007",
                "category": "verified_faq",
                "subcategory": "외주",
                "question": "외주/프리랜서 비용 지급 시 원천징수는?",
                "content": """[법적 근거: 소득세법 제127조, 제129조]

1. 원천징수 세율:
   - 사업소득(프리랜서): 3.3% (소득세 3% + 지방세 0.3%)

2. 원천징수 의무자:
   - 외주비를 지급하는 사업자

3. 신고/납부 기한:
   - 지급일 다음 달 10일까지
   - 홈택스 원천세 신고

4. 필요 서류:
   - 외주 계약서 (권장)
   - 용역 수행 확인서
   - 지급 증빙 (이체내역)
   - 원천징수영수증 발급

5. 경비처리:
   - 지급수수료로 전액 경비 인정
   - 원천징수 전 총액이 경비

6. 원천징수 미이행 시:
   - 원천징수불이행가산세: 미납세액의 10%

7. 외주자(프리랜서) 측:
   - 연말 종합소득세 신고 시 정산
   - 원천징수된 세금은 기납부세액으로 공제""",
                "keywords": ["외주", "프리랜서", "원천징수", "3.3%"],
                "business_types": ["all"],
                "source": "소득세법 제127조, 제129조",
                "verified_date": "2024-01-01"
            },
            {
                "id": "vfaq_008",
                "category": "verified_faq",
                "subcategory": "교육",
                "question": "업무 관련 교육비/강의 수강료 처리 방법은?",
                "content": """[법적 근거: 소득세법 기본통칙 27-0...1]

1. 인정 범위:
   - 현재 수행 중인 업무와 직접 관련된 교육
   - 업무 수행에 필요한 자격증 취득 비용
   - 사업과 관련된 세미나, 컨퍼런스 참가비

2. 인정되는 예시:
   - 개발자: 프로그래밍 강좌, IT 자격증
   - 디자이너: 디자인 툴 교육, UX 세미나
   - 마케터: 마케팅 교육, 데이터 분석 강좌
   - 컨설턴트: 전문 분야 교육, 경영 세미나

3. 불인정 예시:
   - 취미 목적 교육 (요리, 악기, 운동 등)
   - 업무와 무관한 외국어 학원
   - 자녀 교육비

4. 계정과목: 교육훈련비

5. 증빙:
   - 수강료 영수증/세금계산서
   - 수강 증명서 (권장)
   - 자격증 취득 증빙""",
                "keywords": ["교육비", "강의", "자격증", "세미나"],
                "business_types": ["all"],
                "source": "소득세법 기본통칙 27-0...1",
                "verified_date": "2024-01-01"
            }
        ]

    def _get_business_guides(self) -> List[Dict]:
        """업종별 경비 가이드"""
        return [
            {
                "id": "guide_freelancer_001",
                "category": "business_guide",
                "subcategory": "프리랜서",
                "business_type": "freelancer",
                "title": "프리랜서(IT/디자인/번역) 세무 가이드",
                "content": """[프리랜서 주요 경비 항목]

1. 장비/소프트웨어
   - 노트북, 모니터, 키보드 등 업무장비
   - 소프트웨어 라이선스 (포토샵, 개발툴 등)
   - 클라우드 서비스 (AWS, 호스팅 등)

2. 통신/인터넷
   - 업무용 휴대폰 요금
   - 인터넷 요금 (겸용 시 50%)
   - 화상회의 서비스

3. 작업공간
   - 공유오피스/코워킹스페이스
   - 자택 사무공간 (면적비율 안분)
   - 카페 업무 시 음료비 (적정범위)

4. 교육/자기계발
   - 업무 관련 강좌
   - 기술 서적
   - 자격증 취득비용

5. 협업/외주
   - 외주 개발/디자인비 (3.3% 원천징수)
   - 협업 도구 구독료

[수입 신고]
- 3.3% 원천징수된 소득도 종합소득세 신고 필수
- 경비 증빙 철저히 하면 환급 가능

[권장사항]
- 사업자등록 권장 (매입세액 공제 가능)
- 사업용 카드/계좌 분리 운영""",
                "keywords": ["프리랜서", "개발자", "디자이너", "번역"],
                "business_types": ["freelancer", "developer", "designer", "translator"],
                "source": "국세청 1인 창조기업 가이드",
                "verified_date": "2024-01-01"
            },
            {
                "id": "guide_creator_001",
                "category": "business_guide",
                "subcategory": "크리에이터",
                "business_type": "creator",
                "title": "유튜버/크리에이터 세무 가이드",
                "content": """[크리에이터 주요 경비 항목]

1. 촬영 장비
   - 카메라, 렌즈, 조명, 마이크
   - 짐벌, 삼각대, 배경지
   - 편집용 컴퓨터/모니터

2. 소프트웨어
   - 편집 프로그램 (프리미어, 파이널컷 등)
   - 음악/효과음 라이선스
   - 썸네일 제작 툴

3. 콘텐츠 제작비
   - 촬영용 소품, 의상
   - 리뷰/먹방용 제품/음식
   - 스튜디오 대여비

4. 외주비
   - 영상 편집 외주
   - 썸네일 디자인 외주
   - 자막/번역 외주

5. 마케팅
   - 광고 비용
   - 협업 비용

[수입 신고]
- 애드센스 수익: 종합소득세 신고 (외화 → 원화 환산)
- 협찬 물품: 시가로 수입 신고 필요
- 슈퍼챗/후원금: 기타소득으로 신고

[유의사항]
- 해외 수익은 입금일 기준 환율로 환산
- 협찬 물품 수령 시 세금계산서 발급 요청
- 콘텐츠와 관련 없는 개인 구매는 경비 불인정""",
                "keywords": ["유튜버", "크리에이터", "인플루언서", "애드센스"],
                "business_types": ["youtuber", "creator", "influencer"],
                "source": "국세청 1인 미디어 사업자 가이드",
                "verified_date": "2024-01-01"
            },
            {
                "id": "guide_seller_001",
                "category": "business_guide",
                "subcategory": "온라인셀러",
                "business_type": "online_seller",
                "title": "온라인 셀러(스마트스토어/쿠팡) 세무 가이드",
                "content": """[온라인 셀러 주요 경비 항목]

1. 매입비 (가장 큰 비중)
   - 상품 구매 비용
   - 부대비용 (관세, 운송비 등)
   ※ 세금계산서 필수 수취

2. 플랫폼 수수료
   - 네이버 스마트스토어 수수료
   - 쿠팡/11번가 등 판매 수수료
   - PG사 결제 수수료

3. 물류/배송
   - 택배비
   - 포장재 (박스, 완충재, 테이프)
   - 창고 임대료

4. 광고/마케팅
   - 네이버 쇼핑 광고
   - 쿠팡 광고
   - SNS 광고

5. 운영비
   - 사무실/창고 임대료
   - 인터넷, 통신비
   - 재고관리 소프트웨어

[세금 신고]
- 부가세: 일반과세자 연 2회 / 간이과세자 연 1회
- 종소세: 매년 5월

[주의사항]
- 매출 8,000만원 초과 시 일반과세자 전환
- 재고자산 = 자산 (기말재고는 비용 아님)
- 해외구매대행: 관세/부가세 처리 주의""",
                "keywords": ["온라인셀러", "스마트스토어", "쿠팡", "판매"],
                "business_types": ["online_seller", "ecommerce"],
                "source": "국세청 전자상거래 사업자 가이드",
                "verified_date": "2024-01-01"
            },
            {
                "id": "guide_cafe_001",
                "category": "business_guide",
                "subcategory": "음식점/카페",
                "business_type": "restaurant",
                "title": "음식점/카페 사장 세무 가이드",
                "content": """[음식점/카페 주요 경비 항목]

1. 식재료/원재료 (가장 큰 비중)
   - 식자재 구매비
   - 원두, 우유, 시럽 등
   ※ 매입 세금계산서 필수

2. 임대료
   - 매장 월세
   - 관리비

3. 인건비
   - 직원 급여
   - 4대보험 사업자 부담분
   - 아르바이트 급여 (원천징수 필요)

4. 공과금
   - 전기, 가스, 수도료
   - 통신비

5. 소모품
   - 일회용품 (컵, 냅킨, 포장용기)
   - 청소용품
   - 주방 소모품

6. 수수료
   - 배달앱 수수료 (배민, 요기요)
   - 카드결제 수수료
   - POS 이용료

7. 마케팅
   - 간판, 메뉴판 제작
   - 광고비

[세금 신고]
- 부가세: 분기별 또는 반기별
- 종소세: 매년 5월
- 원천세: 직원 급여 지급 시 매월

[유의사항]
- 현금매출 성실신고 (신용카드 의무발행업종)
- 매입 세금계산서 철저히 챙기기
- 폐기/자가소비 재고 처리 주의""",
                "keywords": ["음식점", "카페", "식당", "자영업"],
                "business_types": ["restaurant", "cafe", "food"],
                "source": "국세청 음식점업 사업자 가이드",
                "verified_date": "2024-01-01"
            }
        ]


async def main():
    collector = TaxDataCollector()
    await collector.collect_all()

    # 기존 더미 데이터 파일 정리
    data_dir = Path(__file__).parent.parent / "data" / "knowledge"
    old_files = ["tax_laws.json", "expense_categories.json", "business_types.json", "faq.json"]
    for old_file in old_files:
        old_path = data_dir / old_file
        if old_path.exists():
            old_path.rename(data_dir / f"_old_{old_file}")
            print(f"기존 파일 백업: {old_file} → _old_{old_file}")


if __name__ == "__main__":
    asyncio.run(main())
